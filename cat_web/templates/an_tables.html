{% extends 'base_home.html'%}


{% block head %}
<title>Analisis Inteligentes de datos</title>
{% endblock %}


{% block body %}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Bievenido {{current_user.username}}!!!</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
      <div class="btn-group mr-2">
        <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
        <button  type="button" class="btn btn-sm btn-outline-secondary">Export</button>
        <a href="{{url_for('pdfDownload')}}" class="btn btn-outline-secondary">Exportar a pdf</a>
      </div>
      <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
        <span data-feather="calendar"></span>
        This week
      </button>
    </div>
  </div>

  
  <!-- <canvas class="my-4 w-100" id="myChart" width="900" height="380"></canvas> -->

  <h2>(Base de datos AdventureWorks2017)</h2>
  <div class="table-responsive">
    <table id="tbl_ad" class="table table-striped table-sm table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>Pais</th>
          <th>Email</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <h2>(Base de datos Progressql dvdrental)</h2>
  <div class="table-responsive">
    <table id="tbl_dvd" class="table table-striped table-sm table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>Pais</th>
          <th>Email</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  
  <div class="card border-bottom text-white bg-primary">
    <div class="card-header">
      Analisis de datos 
    </div>
    <div class="card-body">
      <h5 class="card-title">Nueva Base de datos {{griselda}}</h5>
      <p class="card-text">Siguiente Informacion contierne los datos obtenidos de la base de datos dvdrental y ADVENTUREWORKS2017</p>
     
        <button id="btnMostrar" name="submit_button" value="Hola bebe" class="btn btn-outline-info">Unir datos</button>
     <!-- <button id="submit" name="submit_button" value="Hola bebes" class="btn btn-outline-danger">Borrar datos</button> -->
      
      
    </div>
    <div class="card-footer text-muted">
     Equipo Desarrollo: Alex Cassio,Hiram Sifuentes y Victor Nava
    </div>
  </div>

<div id="informacion" style="display: none;">


  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Reporte de Analisis</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
      <div class="btn-group mr-2">
        <a href="{{url_for('pdfDownload')}}" class="btn btn-outline-secondary">Exportar a pdf</a>
      </div>
    </div>
  </div>



  <div class="table-responsive border-bottom">
    <table id="tbl_cutipa" class="table table-striped table-sm table-hover">
      <thead>
        <tr class="table-primary">
          <th>id</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Direcccion</th>
          <th>Zip code</th>
          <th>Phone</th>
          <th>Ciudad</th>
          <th>Pais</th>
        </tr>
      </thead>
      <tbody>  
      </tbody>
    </table>
    <hr>
    
  </div>

  <div class="card-deck">
    <div class="card text-white bg-primary" style="max-width: 28rem;">
      <h5 class="card-header">Mediana</h5>
      <div class="card-body">
        <h5 class="card-title text-center">{{mediana}}</h5>
        <p class="card-text">nuki</p>
        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
      </div>
    </div>
    <div class="card text-white bg-primary" style="max-width: 28rem;">
      <h5 class="card-header">Media</h5>
      <div class="card-body">
        <h5 class="card-title text-center">{{mean}}</h5>
        <p class="card-text">S</p>
        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
      </div>
    </div>
    <div class="card text-white bg-primary" style="max-width: 28rem;">
      <h5 class="card-header">Moda</h5>
      <div class="card-body">
        <h5 class="card-title text-center">{{modas}}</h5>
        <p class="card-text">Tsss</p>
        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
      </div>
    </div>
  </div>
  <br>
  <div class="border-top my-3"></div>
<!---style="width: 600px; height: 400px"-->
  <div id="world-map" style="width: 600px; height: 400px"></div>
  <div class="border-top my-3"></div>
  <br>
  <div class="">
    <div class="row">
      <div class="col-4">
        <h2>Informacion</h2>
        <P>Lo que se planea hacer es buscar la manera de incrementar las ventas en estos países
          y se utilizaran las técnicas de venta de los aquellos países que están por encima de la
          media. conviene analizar si existe algún patrón o algo en común entre esos países que
          se pueda aprovechar de tal manera que los niveles de venta sean lo más nivelados
          posible</P>
      </div>
      <div class="col-8">
        <div class="table-responsive border-bottom">
          <table id="tbl_paiss" class="table table-striped table-sm table-hover">
            <thead>
              <tr class="table-primary">
                <th>Pais</th>
                <th>Numero De clientes</th>
              </tr>
            </thead>
            <tbody>  
            </tbody>
          </table>
          <hr>
        </div>
      </div>
    </div>
  </div>

  <hr>
 <canvas class="my-4 w-100" id="gph_cutipa" width="900" height="380"></canvas>
</div>
{% endblock %}
{% block tail_js %}

<script>
  var btn1 = $('#btnMostrar');

  $(document).ready( function () {
    //tabla dde MS-SQL
    var table = $('#tbl_ad').DataTable({
      processing:true,
    ajax:"{{url_for('dMsql')}}",
    columns:[
            { "data": "ID" },
            { "data": "FirstName" },
            { "data": "LastName" },
            { "data": "Country" },
            { "data": "Email" }

    ],
    dom:'Bfrtilp',
    buttons:[

    {
                "extend":'pdfHtml5',
                "text":'<i class="fas fa-file-pdf">&nbsp;PDF</i>',
                "titleAttr":'Exportar a PDF',
                "className":'btn btn-outline-danger'
            },
            {
                "extend":'print',
                "text":'<i class="fas fa-print">&nbsp;Print</i>',
                "titleAttr":'Print',
                "className":'btn btn-outline-info'
            },
            {
                "extend":'excel',
                "text":'<i class="far fa-file-excel">&nbsp;Excel</i>',
                "titleAttr":'excel',
                "className":'btn-outline-success'
            },

    ]
  });
  //tabla Posgresal
  var table2 = $('#tbl_dvd').DataTable({
    processing:true,
    ajax:"{{url_for('dpos')}}",
    columns:[
            { "data": "ID" },
            { "data": "FirstName" },
            { "data": "LastName" },
            { "data": "Country" },
            { "data": "Email" }

    ],
    dom:'Bfrtilp',
    buttons:[

    {
                "extend":'pdfHtml5',
                "text":'<i class="fas fa-file-pdf">&nbsp;PDF</i>',
                "titleAttr":'Exportar a PDF',
                "className":'btn btn-outline-danger'
            },
            {
                "extend":'print',
                "text":'<i class="fas fa-print">&nbsp;Print</i>',
                "titleAttr":'Print',
                "className":'btn btn-outline-info'
            },
            {
                "extend":'excel',
                "text":'<i class="far fa-file-excel">&nbsp;Excel</i>',
                "titleAttr":'excel',
                "className":'btn-outline-success'
            },
    ]
  });




btn1.on("click", function(){

  var datito;
  //Obtner los datos agrupados
  $.getJSON("{{url_for('paisG')}}",function(data){
    var salve =null;
    var codeName = {};
    var ncode;
    var ncame;
    var cnts ={}
    var continentsByGruoup ={}
 
//datos por continent?
$.ajax(
{
    url: "{{url_for('continentss')}}",
    dataType: "json",
    async: false,
    success: function(data)
    {
      var continente = data.map(function(s){
        return s.continent;
      });
      var pais = data.map(function(s){
        return s.country;
      })
     
     for (let i = 0; i < continente.length; i++) {
          cnts[pais[i]] = continente[i]; 
     }

    }
});



    //Obtner los datos con code EU necesarios par mapa
 $.ajax(
{
    url: "{{url_for('codeguito')}}",
    dataType: "json",
    async: false,
    success: function(data)
    {
      salve = data;
    }
});
//obtner los datos por pais code?

$.ajax(
{
    url: "{{url_for('codegui')}}",
    dataType: "json",
    async: false,
    success: function(data)
    {
      ncode = data.map(function(d){
        return d.Code
      });
      ncame = data.map(function(d){
        return d.Name
      });
      
      for(var j=0; j <ncode.length;j++){
        codeName[ncame[j]] =ncode[j]; 
      }
    }
}); 

function cats(datito){

    if(datito === "Kazakstan"){
      var menso = "Kazakhstan"
      return menso;
    }else if(datito == "Congo, The Democratic Republic of the"){
      var menso = "The Democratic Republic of Congo";
      return menso;
    }else{
      return datito;
    }

}

var piss;
var nCliente;
var objs = {};
//objeto de pruebas
var abs = {}
var noodle;
//obtner los datos del json en separados
piss = data.data.map(function(d){
  return d.Pais
});

nCliente = data.data.map(function(d){
  return d.NumeroClientes
});
//los datos obtneidos convertidos en objeto para su manupulacion
for(var i=0;i< piss.length;i++){
    objs[piss[i]] = nCliente[i];
}

//pruebas
for(var i=0;i<piss.length;i++){
   
    var sorete = codeName[piss[i]]
    abs[sorete] = nCliente[i] 
}
//obtner la lista de pais por continentes continentsByGruoup
var nelson;
var asia = 0;
for (let k = 0; k < piss.length; k++) {
      var soledads = cats(piss[k])
      var coconout = cnts[soledads]

      if( coconout === "Asia"){

        asia  = (nCliente[k] * 100) / 19107;
      }
        
      
}
console.log(asia)

//var valores = jvm.values.apply({},jvm.values(objs))
$('#world-map').vectorMap({
map: 'world_mill',
series: {
  regions: [{
    values:abs,
    scale:  ['#FEE5D9', '#A50F15'],
    normalizeFunction: 'polynomial',
    legend:{
      vertical:true
    }
  }]
},
onRegionTipShow: function(e, el, code){
    noodle = salve[code]
    el.html(el.html()+' Numero de clientes - '+abs[code]+')');
  }

});

  });
  
  mostrarDatos();
  $('#informacion').show();
  

});

  });//final

function mostrarDatos() {
  //Tabla de analisis con los datos unidos
  var table2 = $('#tbl_cutipa').DataTable({
    processing:true,
    ajax:"{{url_for('kombine')}}",
    columns:[
            { "data": "ID" },
            { "data": "firstName" },
            { "data": "email" },
            { "data": "address" },
            { "data": "zip" },
            { "data": "phone" },
            { "data": "ciudad" },
            { "data": "country" }

    ],
    dom:'Bfrtilp',
    buttons:[

    {
                "extend":'pdfHtml5',
                "text":'<i class="fas fa-file-pdf">&nbsp;PDF</i>',
                "titleAttr":'Exportar a PDF',
                "className":'btn btn-outline-danger'
            },
            

            {
                "extend":'excel',
                "text":'<i class="far fa-file-excel">&nbsp;Excel</i>',
                "titleAttr":'excel',
                "className":'btn-outline-success'
            },
    ]
  });

  var table4 = $('#tbl_paiss').DataTable({
    processing:true,
    ajax:"{{url_for('paisG')}}",
    columns:[
            { "data": "Pais" },
            { "data": "NumeroClientes" }
    ],
    dom:'Bfrtilp',
    buttons:[

    {
                "extend":'pdfHtml5',
                "text":'<i class="fas fa-file-pdf">&nbsp;PDF</i>',
                "titleAttr":'Exportar a PDF',
                "className":'btn btn-outline-danger'
            },
            {
                "extend":'excel',
                "text":'<i class="far fa-file-excel">&nbsp;Excel</i>',
                "titleAttr":'excel',
                "className":'btn-outline-success'
            },
    ]
  });

  

}

</script>

{% endblock %}